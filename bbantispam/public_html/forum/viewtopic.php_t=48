<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>bbAntiSpam :: View topic - Blocking &lt;a&gt; posts</title>
<link rel="stylesheet" href="templates/subSilver/subSilver.css" type="text/css">
</head>
<body>
<p><span class="maintitle">bbAntiSpam: Discuss how to stop web spam</span></p>
<p style="background-color:yellow"><font size="7">The forum is retired.</font></p>

<p class="maintitle"><a href="index.php">bbAntiSpam Forum Index</a> - <a href="viewforum.php?f=1">Links Rejector</a> - <a href="viewtopic.php?t=48">Blocking &lt;a&gt; posts</a></p>
<p></p>


<table class="forumline" width="100%" cellspacing="1" cellpadding="3" border="0">
	<tr>
		<th class="thLeft" width="150" height="26" nowrap="nowrap">Author</th>
		<th class="thRight" nowrap="nowrap">Message</th>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row1"><span class="name"><a name="272"></a><b>DickS</b></span><br /><span class="postdetails"><br /><br /><br />Joined: 08 Aug 2006<br />Posts: 13<br /></span><br /></td>
		<td class="row1" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Mon Sep 11, 2006 8:08 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: Blocking &lt;a&gt; posts</span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">Example: <a href="http://www.pamela-systems.com/forum/viewtopic.php?p=3277#3277" target="_blank">www.pamela-systems.com/forum/viewtopic.php?p=3277#3277</a>
<br />

<br />
How to block these posts as they seem to get through? They are useless of course, but a robot is adding this junk to the forum. Would be nice to block this too.</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row2"><span class="name"><a name="275"></a><b>admin</b></span><br /><span class="postdetails">Site Admin<br /><br /><br />Joined: 18 Apr 2006<br />Posts: 805<br />Location: Saint-Petersburg, Russia</span><br /></td>
		<td class="row2" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Tue Sep 12, 2006 4:22 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">Strange... It should be blocked. It seems I need the source code of the posting. Under Admin, click &quot;edit&quot; to get it. Please PM me with the user name, the posting subject and its source code. Thanks.</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row1"><span class="name"><a name="277"></a><b>admin</b></span><br /><span class="postdetails">Site Admin<br /><br /><br />Joined: 18 Apr 2006<br />Posts: 805<br />Location: Saint-Petersburg, Russia</span><br /></td>
		<td class="row1" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Wed Sep 13, 2006 4:28 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">The posting was dummy, without links:
<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">The typical American family has a love and &lt;a&gt;Debt Consolidation&lt;/a&gt; hate relationship with debt. Everyone loves &lt;a&gt;California debt consolidation&lt;/a&gt; spending &lt;a&gt;Debt consolidation Faq&lt;/a&gt; money and no one likes &lt;a&gt;credit card debt consolidation loan&lt;/a&gt; paying it back. That &lt;a&gt;Debt Relief&lt;/a&gt; leads to a nasty situation where ...</td>	</tr></table><span class="postbody">
<br />
The proposed solution from DickS is:
<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">I added */a* to the word censor list and now it is blocked</td>	</tr></table><span class="postbody">
<br />
Wonderful hint!</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row2"><span class="name"><a name="290"></a><b>DickS</b></span><br /><span class="postdetails"><br /><br /><br />Joined: 08 Aug 2006<br />Posts: 13<br /></span><br /></td>
		<td class="row2" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Sat Sep 23, 2006 7:35 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">OK, the word block somehow does not provide 100% protection. I added following code to functions_bbas.php:
<br />

<br />
Find:
<br />

<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">
<br />
	if ($check_for_phone) {
<br />
		preg_match_all(&quot;/[^0-0](\d\d\d-\d\d-?\d\d)/&quot;, $text, $phones);
<br />
		if (count ($phones[0])) {
<br />
			$ret = array_merge ($ret, $phones[0]);
<br />
		}
<br />
	}</td>	</tr></table><span class="postbody">
<br />

<br />

<br />
Add after:
<br />

<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">	//added to block www domain names and posts containing &quot;/a&quot;
<br />
	if (! (FALSE === strpos(strtolower($text), 'www'))) {
<br />
      $ret[] = 'Guest posts can not contain &quot;www&quot;.';
<br />
    } 
<br />
	if (! (FALSE === strpos(strtolower($text), '/a'))) {
<br />
      $ret[] = 'Guest posts can not contain HTML tags.';
<br />
    }</td>	</tr></table><span class="postbody">
<br />

<br />
Cheers!
<br />

<br />
DickS</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row1"><span class="name"><a name="549"></a><b>DickS</b></span><br /><span class="postdetails"><br /><br /><br />Joined: 08 Aug 2006<br />Posts: 13<br /></span><br /></td>
		<td class="row1" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Mon Jan 01, 2007 11:34 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">In new Links Rejector I noticed that posts with &lt;a&gt; are not blocked. Example:
<br />

<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">User name: Thiet Ke Noi That, subject: cong ty du lich viet nam
<br />

<br />
reinduce braconid faradize lopstick rebought &lt;a&gt;Thiet ke noi that&lt;/a&gt;</td>	</tr></table><span class="postbody">
<br />

<br />
The above should not be neccessary with new Links Rejector as this now contains:
<br />

<br />
	</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">//
<br />
	// Extract explicit links (&lt;a href=&quot;...&quot;&gt;...&lt;/a&gt;)
<br />
	//
<br />
	preg_match_all('/href\s*=\s*[&quot;\']([^&quot;\']+)[&quot;\']/', $text, $explicit_links);
<br />
	if (count ($explicit_links[1])) {
<br />
		$ret = array_merge ($ret, $explicit_links[1]);
<br />
	}</td>	</tr></table><span class="postbody">
<br />

<br />
For some reason it does not work 100%. I did not have */a* in word censor list anymore when above string was posted as guest. Strange was that links rejector blocked it but still the post was submitted to forum.
<br />

<br />
Any suggestions what needs to be changed?
<br />

<br />
DickS</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row2"><span class="name"><a name="553"></a><b>admin</b></span><br /><span class="postdetails">Site Admin<br /><br /><br />Joined: 18 Apr 2006<br />Posts: 805<br />Location: Saint-Petersburg, Russia</span><br /></td>
		<td class="row2" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Tue Jan 02, 2007 6:45 am<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">Thanks for reporting. Indeed, this code doesn't work. I've traced the reason why it is so. Links Rejector gets a bit mangled text from phpBB. To be workarounded in the next update.
<br />

<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">Any suggestions what needs to be changed?</td>	</tr></table><span class="postbody">
<br />
Right now, please repeat your changes described in your posting of &quot;23 Sep 2006&quot;.
<br />

<br />
</span><table width="90%" cellspacing="1" cellpadding="3" border="0" align="center"><tr> 	  <td><span class="genmed"><b>Quote:</b></span></td>	</tr>	<tr>	  <td class="quote">Strange was that links rejector blocked it but still the post was submitted to forum.</td>	</tr></table><span class="postbody">
<br />
Probably the rejected message contained someting more, and that more had links.</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	<tr>
		<td width="150" align="left" valign="top" class="row1"><span class="name"><a name="557"></a><b>DickS</b></span><br /><span class="postdetails"><br /><br /><br />Joined: 08 Aug 2006<br />Posts: 13<br /></span><br /></td>
		<td class="row1" width="100%" height="28" valign="top"><table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="100%"><span class="postdetails">Posted: Tue Jan 02, 2007 12:27 pm<span class="gen">&nbsp;</span>&nbsp; &nbsp;Post subject: </span></td>
				<td valign="top" nowrap="nowrap">&nbsp;</td>
			</tr>
			<tr>
				<td colspan="2"><hr /></td>
			</tr>
			<tr>
				<td colspan="2"><span class="postbody">OK, I added */a* to word censor list for the meantime <img src="images/smiles/icon_smile.gif" alt="Smile" border="0" />.
<br />

<br />
Thanks!
<br />

<br />
DickS</span><span class="gensmall"></span></td>
			</tr>
		</table></td>
	</tr>
	<tr>
		<td class="spaceRow" colspan="2" height="1"><img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
</table>

<p></p>

<p>Ok.</p>
</body>
</html>

